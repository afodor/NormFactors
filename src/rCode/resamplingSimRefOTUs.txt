library("ecodist")
library("ape")

rm(list=ls())

setwd("G:\\BigDataScalingFactors\\risk\\dirk\\resample");

writeGraphs <- function( rawFilePath, normFilePath, outFileName )
{
	myT <- read.table(rawFilePath, sep="\t", header=TRUE,row.names=1)
	myTNorm <- read.table(normFilePath , sep="\t", header=TRUE, row.names=1)
	myDist <- bcdist(myT)
	myDistNorm <- bcdist(myTNorm)
	
	myPCOANorm <- pcoa(myDistNorm)
	
	rowSums <- apply(myT, 1, sum)

	countDist<- vector(length=length(rowSums)*(length(rowSums)-1)/2)

	x <- 1
	for( i in 1:(length(rowSums)-1) )
	{
		for( j in ( (i+1):length(rowSums)) )
		{
			countDist[x] <- abs( rowSums[i] - rowSums[j] )
			x = x + 1
		}
	}
	
	pdf(file = outFileName, width=6, height=6)
	#par(mfrow = c(4,2))
	
	rVal <- cor( myDist, countDist, method="spear" );
	title <- paste("raw r^2=", round( rVal * rVal ,digits=3))
	plot(myDist, countDist, main=title, xlab="BC Dist", ylab = "difference in number of sequences")
	
	rVal <- cor( myDistNorm, countDist, method="spear" );
	title <- paste("norm r^2=", round( rVal * rVal ,digits=3))
	plot(myDistNorm, countDist, main=title, xlab="BC Dist", ylab = "difference in number of sequences")
	
	rVal <- cor( log10(rowSums), myPCOANorm$vectors[,1], method="spear" );
	title <- paste("r^2=", round( rVal * rVal ,digits=3))
	plot(log10(rowSums), myPCOANorm$vectors[,1], xlab="log10(Number of Sequences)", ylab = "PCoA1", main=title)
	dev.off();			
}

writeGraphs("resampledcontinious_.txt", "resampledcontinious_rarified.txt", 
			"continiousToRarified.pdf")
 